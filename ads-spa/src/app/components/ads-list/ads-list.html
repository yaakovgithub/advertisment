<div class="search-bar">
  <input
    [(ngModel)]="q"
    type="text"
    placeholder="Type address or a place nearby in any language"
    (keyup.enter)="search()"
  />
  <select [(ngModel)]="category">
    <option value="">All categories</option>
    <option>Buy & Sell</option>
    <option>Rent</option>
    <option>Events</option>
    <option>Travel</option>
  </select>
  <input type="number" [(ngModel)]="minPrice" placeholder="Min $" />
  <input type="number" [(ngModel)]="maxPrice" placeholder="Max $" />
  <button (click)="search()">Go</button>
  <button (click)="toggleNearMe()">{{ nearMe ? 'Clear location' : 'Near me' }}</button>
  <button (click)="openAdForm()">+ New Ad</button>
</div>

<div *ngIf="nearMe" id="nearme-map" style="height: 260px; border-radius: 8px; margin: 8px 0"></div>

<div class="posts-grid">
  <div
    *ngFor="let a of ads"
    class="post-card"
    [ngClass]="{
      'buy-sell': a.category === 'Buy & Sell',
      rent: a.category === 'Rent',
      event: a.category === 'Events',
      travel: a.category === 'Travel'
    }"
  >
    <div style="display: flex; justify-content: space-between; align-items: center">
      <div class="category">{{ a.category }}</div>
      <div
        class="location"
        [ngClass]="{
          'buy-sell': a.category === 'Buy & Sell',
          rent: a.category === 'Rent',
          event: a.category === 'Events',
          travel: a.category === 'Travel'
        }"
        [style.color]="
          a.category === 'Buy & Sell'
            ? '#42a5f5'
            : a.category === 'Rent'
            ? '#66bb6a'
            : a.category === 'Events'
            ? '#ab47bc'
            : '#ffa726'
        "
        style="font-weight: 600"
      >
        <ng-container *ngIf="getCityName(a.address || '') !== 'no location provided'; else noLoc">
          <span>around&nbsp;{{ getCityName(a.address || '') }}</span>
        </ng-container>
        <ng-template #noLoc>
          <span>{{ getCityName(a.address || '') }}</span>
        </ng-template>
      </div>
    </div>
    <div class="title">{{ a.title }}</div>
    <ng-container *ngIf="a.imageUrl; else noImage">
      <img [src]="a.imageUrl" alt="" class="thumbnail" />
      <div class="description">{{ a.description }}</div>
    </ng-container>
    <ng-template #noImage>
      <div class="description no-image">{{ a.description }}</div>
    </ng-template>
    <div class="bottom-meta">
      <div class="bottom-row">
        <div class="price" *ngIf="a.price !== undefined">Price: ${{ a.price }}</div>
        <div class="actions">
          <button class="action-btn edit-btn" (click)="openAdForm(a.id)">Edit</button>
          <button class="action-btn delete-btn" (click)="remove(a)">Delete</button>
        </div>
      </div>
      <div class="ad-meta-fixed">Created at: {{ a.createdAt | date:'medium' }}</div>
    </div>
  </div>
</div>
